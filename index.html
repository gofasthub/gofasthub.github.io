<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>gofasthub</title>
  <link rel="icon" type="image/png" href="fasthublogo.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap');

    :root {
      --accent: #a06bff;
      --accent2: #7b57ff;
      --radius: 18px;
      --glass-bg: rgba(255,255,255,0.08);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #8a6bff, #6ca3ff, #c78cff);
      background-size: 400% 400%;
      animation: gradientShift 12s ease infinite;
      color: #fff;
      overflow: hidden;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }

    .liquidGlass {
      backdrop-filter: blur(10px) saturate(180%);
      background: var(--glass-bg);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      border-radius: var(--radius);
      transition: transform 0.3s, background 0.3s, box-shadow 0.3s;
    }
    .liquidGlass:hover {
      transform: translateY(-4px) scale(1.03);
      background: rgba(255,255,255,0.15);
      box-shadow: 0 18px 50px rgba(0,0,0,0.28);
    }

    .centerWrap {
      width: 100%;
      max-width: 720px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeInUp 0.5s ease;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .liquidGlass-wrapper {
      padding: 28px;
      text-align: center;
      margin-bottom: 20px;
    }
    .liquidGlass-text {
      font-size: 1.9rem;
      font-weight: 700;
      text-transform: lowercase;
      margin-bottom: 14px;
    }

    input, select, button {
      font-family: inherit;
    }
    input[type=password], input[type=text], input[type=number], select {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,0.10);
      color: #fff;
      font-size: 1rem;
      margin-bottom: 10px;
      transition: background 0.2s, transform 0.2s;
    }
    input:focus, select:focus {
      background: rgba(255,255,255,0.18);
      transform: translateY(-2px);
      outline: none;
    }

    .games-page {
      display: none;
      width: 100%;
      max-width: 720px;
      text-align: center;
      padding: 20px;
      animation: fadeInUp 0.5s ease;
    }
    .games-page.active {
      display: block;
    }

    .games-grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
      margin-top: 18px;
    }
    .game-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      height: 200px;
      border-radius: 12px;
      overflow: hidden;
      padding: 12px;
    }
    .game-card img {
      width: 100%;
      height: 65%;
      object-fit: cover;
      border-radius: 8px;
    }
    .game-card .title {
      margin-top: 8px;
      text-transform: uppercase;
      font-weight: 600;
      background: rgba(0,0,0,0.18);
      width: 100%;
      text-align: center;
      padding: 6px 0;
    }
    .game-card button {
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      background: rgba(255,255,255,0.12);
      color: #fff;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
    }
    .game-card button:hover {
      transform: scale(1.05);
      background: rgba(255,255,255,0.2);
    }

    .admin-popup-button {
      position: fixed;
      right: 14px;
      bottom: 14px;
      padding: 8px 10px;
      font-size: 0.8rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,white,0.12);
      background: rgba(255,255,255,0.06);
      color: #fff;
      z-index: 90;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .admin-popup-button:hover {
      transform: scale(1.05);
      background: rgba(255,255,255,0.12);
    }

    .admin-password-popup, .admin-panel {
      position: fixed;
      right: 14px;
      bottom: 70px;
      width: 320px;
      padding: 14px;
      gap: 10px;
      display: none;
      z-index: 91;
      animation: fadeInUp 0.4s ease;
    }
    .admin-panel {
      max-height: 68vh;
      overflow: auto;
    }

    /* optional animations for messages/events */
    .notification {
      opacity: 0;
      animation: bumpIn 0.42s forwards;
    }

    .xp-fab {
      position:fixed;
      right:22px; top:22%;
      padding:10px 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      border-radius: 12px;
      color: #fff;
      cursor: pointer;
      z-index:110;
      display: none;
      box-shadow:0 8px 30px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .xp-fab:hover { transform: scale(1.05); }

    .xp-counter {
      position:fixed;
      right:22px;
      top:calc(22% + 56px);
      font-weight:700;
      color:#fff;
      z-index:110;
      display: none;
    }
    .xp-result {
      position:fixed;
      right:22px;
      top:calc(22% + 96px);
      z-index:110;
      display: none;
    }

    /* rainbow background for taco event */
    .rainbow-bg {
      animation: rainbow 6s linear infinite;
      background-size: 600% 600%;
    }
    @keyframes rainbow{
      0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}
    }
  </style>
</head>
<body id="bodyRoot">
  <div class="centerWrap">
    <div class="liquidGlass liquidGlass-wrapper" id="login-card">
      <div class="liquidGlass-text">welcome to fasthub</div>
      <input id="password" type="password" placeholder="enter access key" autocomplete="off"/>
      <div id="error-msg" style="height:18px;color:#ff7a7a;margin-top:6px"></div>
    </div>

    <div class="liquidGlass games-page" id="games-page">
      <div class="liquidGlass-text">welcome to fasthub</div>
      <div class="games-grid">
        <div class="liquidGlass game-card">
          <img src="eggycar-banner.png" alt="Eggy Car Banner"/>
          <div class="title">eggy car</div>
          <button data-url="https://ubg742.github.io/egycr/index.html">play</button>
        </div>
        <div class="liquidGlass game-card">
          <img src="https://i.kym-cdn.com/entries/icons/facebook/000/053/895/67-kid.jpg" alt="placeholder"/>
          <div class="title">coming soon</div>
          <button disabled>play</button>
        </div>
      </div>
    </div>
  </div>

  <button class="liquidGlass admin-popup-button" id="adminToggleBtn">admin</button>
  <div class="liquidGlass admin-password-popup" id="admin-password-popup">
    <input id="adminPass" type="password" placeholder="enter admin password" autocomplete="off"/>
    <button class="liquidGlass" id="unlockBtn">unlock admin panel</button>
  </div>
  <div class="liquidGlass admin-panel" id="admin-panel">
    <h3 style="text-align:center">global message</h3>
    <input id="adminMessage" type="text" placeholder="Type global message" />
    <input id="duration" type="number" placeholder="Duration (s)" min="1" />
    <button class="liquidGlass" id="sendBtn">Send Message</button>

    <hr style="opacity:.08;border:none;height:1px;margin:10px 0;background:rgba(255,255,255,0.06)">

    <h3 style="text-align:center">global event</h3>
    <select id="eventSelect">
      <option value="tacos">ðŸŒ® Raining Tacos</option>
      <option value="doublexp">âš¡ Double XP</option>
    </select>
    <input id="eventDuration" type="number" placeholder="Event duration (s)" min="5"/>
    <button class="liquidGlass" id="startEventBtn">Start Event</button>
  </div>

  <div class="notification-container" id="notificationContainer"></div>
  <div class="events-stack" id="eventsStack"></div>
  <button class="liquidGlass xp-fab" id="xpFab">+ XP</button>
  <div class="xp-counter" id="xpCounter">XP: 2</div>
  <div class="xp-result" id="xpResult"></div>
  <div id="tacoLayer"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
    import { getDatabase, ref, push, onChildAdded } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDJskELwuyHZVcFZXSX0QHU3e2UgTcRyLQ",
      authDomain: "fasthub-messages.firebaseapp.com",
      databaseURL: "https://fasthub-messages-default-rtdb.firebaseio.com",
      projectId: "fasthub-messages",
      storageBucket: "fasthub-messages.firebasestorage.app",
      messagingSenderId: "788670666897",
      appId: "1:788670666897:web:223bb6a9f8bff4af444730",
      measurementId: "G-8DN5YXWV0V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, 'messages');
    const eventsRef = ref(db, 'events');

    const pwInput = document.getElementById('password');
    const loginCard = document.getElementById('login-card');
    const gamesPage = document.getElementById('games-page');
    const errorMsg = document.getElementById('error-msg');
    const adminToggleBtn = document.getElementById('adminToggleBtn');
    const adminPasswordPopup = document.getElementById('admin-password-popup');
    const adminPanel = document.getElementById('admin-panel');
    const unlockBtn = document.getElementById('unlockBtn');
    const sendBtn = document.getElementById('sendBtn');
    const startEventBtn = document.getElementById('startEventBtn');
    const notificationContainer = document.getElementById('notificationContainer');
    const eventsStack = document.getElementById('eventsStack');
    const xpFab = document.getElementById('xpFab');
    const xpCounter = document.getElementById('xpCounter');
    const xpResult = document.getElementById('xpResult');
    const tacoLayer = document.getElementById('tacoLayer');
    const playBtns = document.querySelectorAll('.play-btn');

    const joinTime = Date.now();
    let clientId = localStorage.getItem('fasthub_client') || 'c_' + Math.random().toString(36).slice(2);
    localStorage.setItem('fasthub_client', clientId);

    function showNotification(msg, s=8){
      const n = document.createElement('div');
      n.className = 'liquidGlass notification';
      n.textContent = msg;
      notificationContainer.appendChild(n);
      setTimeout(()=>{ n.style.animation = 'bumpOut .45s forwards'; setTimeout(()=>n.remove(),450); }, s*1000);
    }

    function tryLogin(){
      const pw = pwInput.value.trim();
      if (pw === 'fast67'){
        loginCard.style.display = 'none';
        gamesPage.classList.add('active');
      } else if (pw === 'fastadmin67'){
        loginCard.style.display = 'none';
        gamesPage.classList.add('active');
        adminPanel.style.display = 'block';
      } else {
        errorMsg.textContent = 'incorrect password. try again.';
        pwInput.value = '';
        pwInput.focus();
      }
    }
    pwInput.addEventListener('keypress', e => { if(e.key === 'Enter') tryLogin(); });

    adminToggleBtn.addEventListener('click', ()=>{
      if (adminPasswordPopup.style.display === 'block'){
        adminPasswordPopup.style.display = 'none';
      } else {
        adminPasswordPopup.style.display = 'block';
      }
    });
    unlockBtn.addEventListener('click', ()=>{
      if (document.getElementById('adminPass').value.trim() === 'fastadmin67'){
        adminPasswordPopup.style.display = 'none';
        adminPanel.style.display = 'block';
      } else {
        alert('Incorrect admin password');
      }
    });

    sendBtn.addEventListener('click', ()=>{
      const text = document.getElementById('adminMessage').value.trim();
      const dur = parseInt(document.getElementById('duration').value) || 10;
      if (!text) return;
      push(messagesRef, { text, expiresIn: dur, timestamp: Date.now() });
    });
    onChildAdded(messagesRef, snap => {
      const m = snap.val();
      if (!m) return;
      const age = Date.now() - (m.timestamp || 0);
      if ((m.timestamp || 0) >= joinTime && age < (m.expiresIn || 10)*1000) {
        showNotification(m.text, m.expiresIn || 10);
      }
    });

    const activeEvents = {};
    function addEvent(id, d){
      const pill = document.createElement('div');
      pill.className = 'liquidGlass event-pill';
      pill.innerHTML = `${d.icon} ${d.name} <span class="timer">${formatTimeWhole(d.duration)}</span>`;
      eventsStack.appendChild(pill);
      activeEvents[id] = { dom: pill, data: d, expiresAt: Date.now() + d.duration*1000 };
      if (d.type === 'tacos') startTacos(id, d.duration);
      if (d.type === 'doublexp') startDoubleXP(id, d.duration);
      const iv = setInterval(()=>{
        const evt = activeEvents[id];
        if (!evt) { clearInterval(iv); return; }
        const left = Math.ceil((evt.expiresAt - Date.now())/1000);
        evt.dom.querySelector('.timer').textContent = formatTimeWhole(left);
        if (left <= 0) { clearInterval(iv); removeEvent(id); }
      }, 900);
    }
    onChildAdded(eventsRef, snap=>{
      const e = snap.val();
      if (!e) return;
      const expiresAt = (e.timestamp || 0) + (e.duration || 0)*1000;
      if (Date.now() < expiresAt){
        const type = e.type || (e.name.toLowerCase().includes('taco') ? 'tacos' : 'doublexp');
        addEvent(snap.key, { name: e.name, icon: e.icon || (type==='tacos'?'ðŸŒ®':'âš¡'), type, duration: Math.ceil((expiresAt - Date.now())/1000) });
      }
    });
    document.getElementById('startEventBtn').addEventListener('click', ()=>{
      const tp = document.getElementById('eventSelect').value;
      const dur = parseInt(document.getElementById('eventDuration').value) || 10;
      const map = {
        tacos: { name: 'ðŸŒ® Raining Tacos', icon: 'ðŸŒ®', type: 'tacos' },
        doublexp: { name: 'âš¡ Double XP', icon: 'âš¡', type: 'doublexp' }
      };
      const d = map[tp];
      push(eventsRef, { name: d.name, icon: d.icon, type: d.type, duration: dur, timestamp: Date.now() });
    });

    // Tacos
    const tacoMap = {};
    function startTacos(id, duration){
      document.body.classList.add('rainbow-bg');
      tacoMap[id] = { iv: setInterval(()=>spawnTaco(id), 260), elems: [] };
      setTimeout(()=> stopTacosFor(id), duration*1000 + 200);
    }
    function spawnTaco(id){
      const el = document.createElement('div');
      el.className = 'taco';
      el.textContent = 'ðŸŒ®';
      const x = Math.random() * (window.innerWidth - 60);
      el.style.left = x + 'px';
      el.style.top = '-60px';
      tacoLayer.appendChild(el);
      tacoMap[id].elems.push(el);
      const dur = 3500 + Math.random()*1600;
      requestAnimationFrame(()=>{
        el.style.transition = `top ${dur}ms linear, transform ${dur}ms ease, opacity 300ms`;
        el.style.top = (window.innerHeight + 80) + 'px';
        el.style.transform = `rotate(${(Math.random()*60)-30}deg)`;
        el.style.opacity = '1';
      });
      setTimeout(()=>{
        el.remove();
        const arr = tacoMap[id]?.elems;
        if (arr) arr.splice(arr.indexOf(el),1);
      }, dur + 300);
    }
    function stopTacosFor(id){
      if (tacoMap[id]){
        clearInterval(tacoMap[id].iv);
        tacoMap[id].elems.forEach(e => e.remove());
        delete tacoMap[id];
      }
      const still = Object.values(activeEvents).some(a => a.data.type === 'tacos');
      if (!still) document.body.classList.remove('rainbow-bg');
    }

    // DOUBLE XP
    function startDoubleXP(id, duration){
      xpFab.style.display = 'block';
      xpCounter.style.display = 'block';
      localStorage.setItem('fasthub_xp_' + clientId, '2');
      xpCounter.textContent = 'XP: 2';
    }
    function stopDoubleXPFor(id){
      const any = Object.values(activeEvents).some(a => a.data.type === 'doublexp');
      if (!any){
        const final = parseInt(localStorage.getItem('fasthub_xp_' + clientId) || '2', 10);
        xpResult.style.display = 'block';
        xpResult.innerHTML = `<div class="liquidGlass" style="padding:10px;border-radius:10px">Final XP: <strong>${final}</strong></div>`;
        setTimeout(()=>{ xpResult.style.opacity = 1; }, 10);
        setTimeout(()=>{ xpResult.style.opacity = 0; setTimeout(()=>xpResult.style.display='none',420) }, 3000);
        localStorage.setItem('fasthub_xp_' + clientId, '2');
        xpCounter.style.display = 'none'; xpFab.style.display = 'none';
      }
    }
    xpFab.addEventListener('click', ()=>{
      let cur = parseInt(localStorage.getItem('fasthub_xp_' + clientId) || '2', 10);
      cur = Math.max(2, cur * 2);
      localStorage.setItem('fasthub_xp_' + clientId, String(cur));
      xpCounter.textContent = 'XP: ' + cur;
      const b = document.createElement('div');
      b.className = 'liquidGlass notification';
      b.textContent = 'xp doubled to ' + cur;
      notificationContainer.appendChild(b);
      setTimeout(()=>{ b.style.animation = 'bumpOut .45s forwards'; setTimeout(()=>b.remove(),450) }, 1200);
    });

    // play button logic
    playBtns.forEach(btn => {
      btn.addEventListener('click', ()=>{
        const url = btn.dataset.url;
        if (!url) return;
        const win = window.open('about:blank', '_blank');
        if (!win) { alert('Popup blocked. Please allow popups.'); return; }
        win.document.open();
        win.document.write(`<!doctype html>
          <html>
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Eggy Car</title>
            <style>html,body{margin:0;padding:0;height:100%;background:#000;}iframe{width:100%;height:100%;border:0;}</style>
          </head>
          <body><iframe src="${btn.dataset.url}" allowfullscreen></iframe></body>
          </html>`);
        win.document.close();
      });
    });
  </script>
</body>
</html>
