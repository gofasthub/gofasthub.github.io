<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>gofasthub</title>
  <link rel="icon" href="fasthublogo.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap');

    :root{
      --accent:#a06bff;
      --accent2:#7b57ff;
      --radius:18px;
      --glass-bg: rgba(255,255,255,0.08);
      --text:#ffffff;
      font-family: 'Outfit', system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#8a6bff,#6ca3ff,#c78cff);
      background-size:400% 400%;
      animation: gradientShift 12s linear infinite;
      color:var(--text);
      overflow:hidden;
    }
    @keyframes gradientShift {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    /* liquid glass base */
    .liquidGlass{
      backdrop-filter: blur(10px) saturate(180%);
      background: var(--glass-bg);
      border:1px solid rgba(255,255,255,0.18);
      box-shadow:0 10px 30px rgba(0,0,0,0.24);
      border-radius:var(--radius);
      transition: all 280ms cubic-bezier(.34,1.56,.64,1);
    }
    .liquidGlass:hover{ transform: translateY(-4px) scale(1.03); box-shadow: 0 18px 50px rgba(0,0,0,0.30) }
    .liquidGlass:active{ transform: translateY(-2px) scale(.99) }

    /* center perfectly */
    .centerWrap{
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      width:100%; max-width:980px; gap:20px; padding:20px;
    }

    .liquidGlass-wrapper{ padding:28px; text-align:center; width:100%; max-width:420px; }
    .liquidGlass-text{ font-size:1.9rem; font-weight:700; text-transform:lowercase; margin-bottom:14px }

    input[type=password],input[type=text],input[type=number],select{
      width:100%; padding:12px; border-radius:12px; border:none;
      background:rgba(255,255,255,0.10); color:var(--text); font-size:1rem; margin-bottom:10px;
    }
    input:focus,select:focus{ outline:none; background:rgba(255,255,255,0.18); transform: translateY(-2px) scale(1.01); box-shadow:0 8px 30px rgba(0,0,0,0.12) }

    .games-page{ display:none; width:100%; max-width:800px; padding:18px; text-align:center; }
    .games-page.active{ display:block }
    .games-grid{ display:grid; gap:18px; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); margin-top:18px }
    .game-card{ border-radius:12px; overflow:hidden; height:200px; display:flex; flex-direction:column; cursor:pointer; transition: transform .28s cubic-bezier(.2,.9,.3,1) }
    .game-card:hover{ transform: translateY(-6px) scale(1.02) }
    .game-card img{ width:100%; height:72%; object-fit:cover; display:block }
    .game-card span{ padding:10px; background: rgba(0,0,0,0.18); text-transform:uppercase; font-weight:600; font-size:0.95rem; text-align:center }

    /* admin small button */
    .admin-popup-button{ position:fixed; right:14px; bottom:14px; padding:8px 10px; font-size:0.78rem; border-radius:12px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:var(--text); z-index:300; cursor:pointer; }

    .admin-password-popup,.admin-panel{ position:fixed; right:14px; bottom:60px; width:320px; padding:14px; gap:10px; display:none; z-index:310; flex-direction:column; }
    .admin-panel{ max-height:68vh; overflow:auto }

    /* notifications */
    .notification-container{ position:fixed; top:28px; left:50%; transform:translateX(-50%); display:flex; flex-direction:column; gap:10px; align-items:center; z-index:400 }
    .notification{ padding:12px 18px; border-radius:12px; min-width:240px; text-align:center; animation: bumpIn 420ms cubic-bezier(.2,.9,.3,1) both; }
    @keyframes bumpIn{ 0% { transform: translateY(-10px) scale(.9); opacity:0 } 60% { transform: translateY(6px) scale(1.05); opacity:1 } 100% { transform: translateY(0) scale(1); opacity:1 } }

    /* events stack */
    .events-stack{ position:fixed; left:14px; bottom:14px; display:flex; flex-direction:column; gap:10px; z-index:320; }
    .event-pill{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background: rgba(0,0,0,0.14); min-width:200px; }
    .event-pill .icon{ font-size:1.4rem }
    .event-pill .timer{ font-weight:700; margin-left:auto }

    /* taco/sparkle particles */
    .particle{ position:fixed; pointer-events:none; z-index:350; font-size:1.9rem; will-change: transform, top, left; }

    /* xp UI */
    .xp-fab{ position:fixed; right:22px; top:22%; padding:10px 14px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border:none; color:#fff; cursor:pointer; z-index:330; display:none; box-shadow:0 8px 30px rgba(0,0,0,0.2) }
    .xp-counter{ position:fixed; right:22px; top:calc(22% + 60px); font-weight:700; z-index:330; color:#fff; display:none }
    .xp-result{ position:fixed; right:22px; top:calc(22% + 110px); z-index:330; display:none }

    /* disco background (animated rainbow) */
    .disco-bg{ animation: discoBg 3s linear infinite; background-size:600% 600% }
    @keyframes discoBg {
      0%{ background:linear-gradient(135deg,#ffb3c6,#a06bff,#6ca3ff,#c78cff) }
      25%{ background:linear-gradient(135deg,#6ca3ff,#c78cff,#ffb3c6,#a06bff) }
      50%{ background:linear-gradient(135deg,#c78cff,#ffb3c6,#a06bff,#6ca3ff) }
      75%{ background:linear-gradient(135deg,#a06bff,#6ca3ff,#c78cff,#ffb3c6) }
      100%{ background:linear-gradient(135deg,#ffb3c6,#a06bff,#6ca3ff,#c78cff) }
    }

    @media (max-width:720px){
      .centerWrap{ width:95%; padding:14px }
      .admin-password-popup, .admin-panel{ right:12px; left:12px; width:auto }
      .game-card{ height:180px }
    }
  </style>
</head>
<body id="bodyRoot">

  <div class="centerWrap">
    <!-- login -->
    <div class="liquidGlass liquidGlass-wrapper" id="login-card" aria-live="polite">
      <div class="liquidGlass-text">welcome to fasthub</div>
      <input id="password" type="password" placeholder="enter access key" autocomplete="off" />
      <div id="error-msg" style="height:18px;color:#ffb3b3;margin-top:8px;"></div>
    </div>

    <!-- games -->
    <div class="liquidGlass games-page" id="games-page" role="region" aria-label="games">
      <h2 class="liquidGlass-text">welcome to fasthub</h2>
      <div class="games-grid">
        <div class="liquidGlass game-card" id="eggy-card" title="Click to play eggy car">
          <!-- file name you said: "eggy car.jpg" (include exactly that file in repo) -->
          <img src="eggy car.jpg" alt="eggy car banner (placeholder)" />
          <span>eggy car</span>
        </div>
      </div>
    </div>
  </div>

  <!-- admin UI -->
  <button class="liquidGlass admin-popup-button" id="adminToggleBtn" aria-label="open admin">admin</button>

  <div class="liquidGlass admin-password-popup" id="admin-password-popup" role="dialog" aria-hidden="true">
    <input id="adminPass" type="password" placeholder="enter admin password" autocomplete="off" />
    <button class="liquidGlass" id="unlockBtn">unlock admin panel</button>
  </div>

  <div class="liquidGlass admin-panel" id="admin-panel" role="dialog" aria-hidden="true" style="display:none;">
    <h3 style="margin:0 0 8px 0;text-align:center">global message</h3>
    <input id="adminMessage" type="text" placeholder="Type global message" />
    <input id="duration" type="number" placeholder="Duration (s)" min="1" />
    <button class="liquidGlass" id="sendBtn">Send Message</button>

    <hr style="opacity:.08;margin:10px 0;border:none;height:1px;background:rgba(255,255,255,0.06)" />

    <h3 style="margin:0 0 8px 0;text-align:center">global event</h3>
    <select id="eventSelect" aria-label="event type">
      <option value="tacos">ðŸŒ® Raining Tacos</option>
      <option value="doublexp">âš¡ Double XP</option>
      <option value="disco">âœ¨ Disco</option>
    </select>
    <input id="eventDuration" type="number" placeholder="Event duration (s)" min="5" />
    <button class="liquidGlass" id="startEventBtn">Start Event</button>
  </div>

  <!-- runtime containers -->
  <div class="notification-container" id="notificationContainer" aria-live="polite"></div>
  <div class="events-stack" id="eventsStack" aria-live="polite"></div>

  <button class="xp-fab" id="xpFab">+ XP</button>
  <div class="xp-counter" id="xpCounter">XP: 2</div>
  <div class="xp-result" id="xpResult"></div>

  <!-- particle layer -->
  <div id="tacoLayer" aria-hidden="true"></div>

  <!-- Firebase + script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Your Firebase config (you provided earlier)
    const firebaseConfig = {
      apiKey: "AIzaSyDJskELwuyHZVcFZXSX0QHU3e2UgTcRyLQ",
      authDomain: "fasthub-messages.firebaseapp.com",
      databaseURL: "https://fasthub-messages-default-rtdb.firebaseio.com",
      projectId: "fasthub-messages",
      storageBucket: "fasthub-messages.firebasestorage.app",
      messagingSenderId: "788670666897",
      appId: "1:788670666897:web:223bb6a9f8bff4af444730",
      measurementId: "G-8DN5YXWV0V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // UI refs
    const pwInput = document.getElementById('password');
    const errorMsg = document.getElementById('error-msg');
    const loginCard = document.getElementById('login-card');
    const gamesPage = document.getElementById('games-page');
    const eggyCard = document.getElementById('eggy-card');
    const adminToggleBtn = document.getElementById('adminToggleBtn');
    const adminPasswordPopup = document.getElementById('admin-password-popup');
    const adminPanel = document.getElementById('admin-panel');
    const unlockBtn = document.getElementById('unlockBtn');
    const sendBtn = document.getElementById('sendBtn');
    const startEventBtn = document.getElementById('startEventBtn');
    const notificationContainer = document.getElementById('notificationContainer');
    const eventsStack = document.getElementById('eventsStack');
    const xpFab = document.getElementById('xpFab');
    const xpCounter = document.getElementById('xpCounter');
    const xpResult = document.getElementById('xpResult');
    const tacoLayer = document.getElementById('tacoLayer');
    const bodyRoot = document.getElementById('bodyRoot') || document.body;

    // PW constants
    const SITE_PW = 'fast67';
    const ADMIN_PW = 'fastadmin67';

    // simple client id
    const clientId = localStorage.getItem('fasthub_client') || ('c_' + Math.random().toString(36).slice(2,9));
    localStorage.setItem('fasthub_client', clientId);

    // helper format seconds -> m:ss
    function fmtSeconds(sec){
      sec = Math.max(0, Math.floor(sec));
      const m = Math.floor(sec/60);
      const s = sec % 60;
      return `${m}:${String(s).padStart(2,'0')}`;
    }

    // login: Enter key
    pwInput.addEventListener('keypress', (e)=>{
      if(e.key === 'Enter'){
        const v = pwInput.value.trim();
        if(v === SITE_PW){
          // animate out
          loginCard.style.transition = 'all 420ms cubic-bezier(.22,1,.36,1)';
          loginCard.style.opacity = '0';
          loginCard.style.transform = 'translateY(-10px) scale(.98)';
          setTimeout(()=>{ loginCard.style.display = 'none'; gamesPage.classList.add('active'); }, 360);
        } else if(v === ADMIN_PW){
          loginCard.style.transition = 'all 420ms cubic-bezier(.22,1,.36,1)';
          loginCard.style.opacity = '0';
          loginCard.style.transform = 'translateY(-10px) scale(.98)';
          setTimeout(()=>{ loginCard.style.display = 'none'; gamesPage.classList.add('active'); adminPanel.style.display = 'flex'; makeDraggable(adminPanel); }, 360);
        } else {
          errorMsg.textContent = 'incorrect password. try again.';
          pwInput.value = '';
          pwInput.focus();
        }
      }
    });

    // admin toggle + unlock
    adminToggleBtn.addEventListener('click', ()=>{
      if(adminPasswordPopup.style.display === 'flex'){
        adminPasswordPopup.style.display = 'none';
      } else {
        adminPasswordPopup.style.display = 'flex';
        adminPasswordPopup.style.flexDirection = 'column';
        adminPasswordPopup.querySelector('input')?.focus();
      }
    });
    unlockBtn.addEventListener('click', ()=>{
      const v = document.getElementById('adminPass').value.trim();
      if(v === ADMIN_PW){
        adminPasswordPopup.style.display = 'none';
        adminPanel.style.display = 'flex';
        makeDraggable(adminPanel);
      } else {
        alert('Incorrect admin password');
      }
    });

    // open Eggy Car in about:blank with iframe
    eggyCard.addEventListener('click', ()=>{
      const url = 'https://ubg742.github.io/egycr/index.html';
      const w = window.open('about:blank', '_blank');
      if(!w){ alert('Popup blocked: allow popups for this site'); return; }
      const html = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>eggy car</title><style>html,body{height:100%;margin:0;background:#000}iframe{border:0;width:100%;height:100vh}</style></head><body><iframe src="${url}" allowfullscreen></iframe></body></html>`;
      w.document.open();
      w.document.write(html);
      w.document.close();
    });

    // notifications
    function showNotification(text, seconds=8){
      const n = document.createElement('div');
      n.className = 'liquidGlass notification';
      n.textContent = text;
      notificationContainer.appendChild(n);
      setTimeout(()=>{
        n.style.transition = 'transform 420ms ease, opacity 420ms ease';
        n.style.transform = 'scale(.85) translateY(-10px)';
        n.style.opacity = '0';
        setTimeout(()=> n.remove(), 420);
      }, seconds * 1000);
    }

    // EVENTS: stackable
    const activeEvents = {}; // key -> {dom, expiresAt, data}
    const particleState = {}; // key -> {iv, elems, type}

    function addEventToStack(key, data, remaining){
      const pill = document.createElement('div');
      pill.className = 'liquidGlass event-pill';
      const icon = document.createElement('div'); icon.className = 'icon'; icon.textContent = data.icon || (data.type === 'tacos' ? 'ðŸŒ®' : (data.type === 'disco' ? 'âœ¨' : 'âš¡'));
      const name = document.createElement('div'); name.textContent = data.name;
      const timer = document.createElement('div'); timer.className = 'timer'; timer.textContent = fmtSeconds(remaining);
      pill.appendChild(icon); pill.appendChild(name); pill.appendChild(timer);
      eventsStack.appendChild(pill);

      activeEvents[key] = { dom: pill, expiresAt: Date.now() + remaining*1000, data };

      // start specific behavior
      if(data.type === 'tacos') startTacos(key);
      if(data.type === 'doublexp') startDoubleXP(key);
      if(data.type === 'disco') startDisco(key);

      // countdown updater
      const iv = setInterval(()=>{
        const ev = activeEvents[key];
        if(!ev){ clearInterval(iv); return; }
        const left = Math.ceil((ev.expiresAt - Date.now())/1000);
        ev.dom.querySelector('.timer').textContent = fmtSeconds(left);
        if(left <= 0){
          clearInterval(iv);
          removeEvent(key);
        }
      }, 900);
    }

    function removeEvent(key){
      const ev = activeEvents[key];
      if(!ev) return;
      try{ ev.dom.remove(); }catch(e){}
      // stop behaviors tied to key
      stopParticlesFor(key);
      stopDoubleXPForKey(key);
      stopDiscoIfNeeded();
      delete activeEvents[key];
    }

    // --- Tacos behavior ---
    function startTacos(key){
      // add rainbow-ish background as well (optional)
      document.body.classList.add('disco-bg'); // lightweight reuse to add color while tacos fall (disco-bg is colorful)
      // spawn particles
      particleState[key] = { iv: setInterval(()=>spawnParticle(key,'ðŸŒ®'), 260), elems: [], type:'tacos' };
    }
    function spawnParticle(key, emoji){
      const el = document.createElement('div');
      el.className = 'particle';
      el.textContent = emoji;
      const left = Math.random() * (window.innerWidth - 40);
      el.style.left = left + 'px';
      el.style.top = '-60px';
      tacoLayer.appendChild(el);
      particleState[key].elems.push(el);

      const dur = 3000 + Math.random()*1500;
      requestAnimationFrame(()=>{
        el.style.transition = `top ${dur}ms linear, transform ${dur}ms cubic-bezier(.2,.9,.2,1), opacity 400ms`;
        el.style.top = (window.innerHeight + 80) + 'px';
        el.style.transform = `rotate(${(Math.random()*80)-40}deg)`;
        el.style.opacity = '1';
      });
      setTimeout(()=>{ try{ el.remove(); const a = particleState[key]?.elems; if(a) a.splice(a.indexOf(el),1) }catch(e){} }, dur + 300);
    }
    function stopParticlesFor(key){
      if(!particleState[key]) return;
      clearInterval(particleState[key].iv);
      particleState[key].elems.forEach(el=>el.remove());
      delete particleState[key];
      // if no remaining taco/disco particles, remove disco-bg (we check disco separately)
      const anyParticles = Object.values(particleState).length > 0;
      if(!anyParticles){
        document.body.classList.remove('disco-bg');
      }
    }

    // --- Disco behavior (sparkles + rainbow background) ---
    function startDisco(key){
      // add rainbow background class
      document.body.classList.add('disco-bg');
      // spawn sparkle emojis (âœ¨)
      particleState[key] = { iv: setInterval(()=>spawnParticle(key,'âœ¨'), 180), elems: [], type:'disco' };
    }
    function stopDiscoIfNeeded(){
      // remove disco-bg if no disco events active
      const anyDisco = Object.values(activeEvents).some(e => e.data.type === 'disco');
      if(!anyDisco){
        // stop disco particles if any (they are cleaned in stopParticlesFor when event removed)
        document.body.classList.remove('disco-bg');
      }
    }

    // --- Double XP behavior ---
    const doubleXPMap = {}; // key -> true
    function startDoubleXP(key){
      doubleXPMap[key] = true;
      // show xp UI and init xp to 2 for this client
      xpFab.style.display = 'block';
      xpCounter.style.display = 'block';
      localStorage.setItem('fasthub_xp_' + clientId, '2');
      xpCounter.textContent = 'XP: 2';
    }
    function stopDoubleXPForKey(key){
      if(doubleXPMap[key]) delete doubleXPMap[key];
      // if no other doublexp active, hide and show final result then reset
      const anyDouble = Object.keys(activeEvents).some(k => activeEvents[k].data.type === 'doublexp');
      if(!anyDouble){
        const final = parseInt(localStorage.getItem('fasthub_xp_' + clientId) || '2', 10);
        // show result popup
        xpResult.style.display = 'block';
        xpResult.innerHTML = `<div class="liquidGlass" style="padding:10px;border-radius:10px">final xp: <strong>${final}</strong></div>`;
        setTimeout(()=>{ xpResult.style.opacity = 1; }, 10);
        setTimeout(()=>{ xpResult.style.opacity = 0; setTimeout(()=> xpResult.style.display = 'none', 420); }, 3000);
        // reset xp to 2 and hide UI
        localStorage.setItem('fasthub_xp_' + clientId, '2');
        xpCounter.style.display = 'none';
        xpFab.style.display = 'none';
      }
    }

    xpFab.addEventListener('click', ()=>{
      let cur = parseInt(localStorage.getItem('fasthub_xp_' + clientId) || '2', 10);
      cur = Math.max(2, cur * 2);
      localStorage.setItem('fasthub_xp_' + clientId, String(cur));
      xpCounter.textContent = 'XP: ' + cur;
      // small temporary notification
      const b = document.createElement('div');
      b.className = 'liquidGlass notification';
      b.textContent = 'xp doubled to ' + cur;
      notificationContainer.appendChild(b);
      setTimeout(()=>{ b.style.transition='transform .42s, opacity .42s'; b.style.transform='scale(.85) translateY(-8px)'; b.style.opacity='0'; setTimeout(()=>b.remove(),420); }, 1200);
    });

    // --- Firebase realtime push/listen ---
    const messagesRef = ref(db, 'global/messages');
    const eventsRef = ref(db, 'global/events');

    // Admin sends message (keeps text in input â€” you asked to be able to spam)
    sendBtn.addEventListener('click', ()=>{
      const text = document.getElementById('adminMessage').value.trim();
      const duration = Math.max(1, parseInt(document.getElementById('duration').value, 10) || 8);
      if(!text) return;
      push(messagesRef, { text, duration, timestamp: Date.now() });
    });

    // Admin starts events
    startEventBtn.addEventListener('click', ()=>{
      const type = document.getElementById('eventSelect').value;
      const duration = Math.max(5, parseInt(document.getElementById('eventDuration').value, 10) || 30);
      const map = {
        tacos: { name: 'Raining Tacos', icon: 'ðŸŒ®', type: 'tacos' },
        doublexp: { name: 'Double XP', icon: 'âš¡', type: 'doublexp' },
        disco: { name: 'Disco', icon: 'âœ¨', type: 'disco' }
      };
      const d = map[type] || { name: type, icon: '', type };
      push(eventsRef, { name: d.name, icon: d.icon, type: d.type, duration, timestamp: Date.now() });
    });

    // Listen for new messages (global)
    onChildAdded(messagesRef, snapshot => {
      const m = snapshot.val();
      if(!m) return;
      showNotification(m.text, m.duration || 8);
    });

    // Listen for new events (global)
    onChildAdded(eventsRef, snapshot => {
      const e = snapshot.val();
      if(!e) return;
      const now = Date.now();
      const expiresAt = (e.timestamp || now) + ( (e.duration || 0) * 1000 );
      const remaining = Math.max(0, Math.ceil((expiresAt - now) / 1000));
      if(remaining <= 0) return;
      const key = snapshot.key;
      addEventToStack(key, { name: e.name, icon: e.icon, type: e.type }, remaining);
    });

    // draggable helper for admin panel
    function makeDraggable(el){
      el.style.position = 'fixed';
      let dragging = false, offX = 0, offY = 0;
      el.addEventListener('mousedown', (e)=>{
        dragging = true;
        offX = e.clientX - (el.offsetLeft || 0);
        offY = e.clientY - (el.offsetTop || 0);
        el.style.cursor = 'grabbing';
      });
      document.addEventListener('mouseup', ()=>{ dragging = false; el.style.cursor = 'grab'; });
      document.addEventListener('mousemove', (e)=>{
        if(!dragging) return;
        e.preventDefault();
        let left = e.clientX - offX;
        let top = e.clientY - offY;
        left = Math.max(8, Math.min(window.innerWidth - el.offsetWidth - 8, left));
        top = Math.max(8, Math.min(window.innerHeight - el.offsetHeight - 8, top));
        el.style.left = left + 'px';
        el.style.top = top + 'px';
      });
    }

    // console
    console.log('gofasthub loaded â€” clientId:', clientId);
  </script>
</body>
</html>
